<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ฐานข้อมูลพรรณไม้</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Prompt","Sarabun",sans-serif;
      background-color: #f7faff;
      margin:0;padding:0;color:#333;
    }
    header {
      background: #a7e8bd;
      color:#333;
      text-align:center;
      padding:1rem;
      box-shadow:0 2px 5px rgba(0,0,0,0.1);
    }
    header h1 {margin:0;font-size:1.5rem;}
    nav {margin-top:0.5rem;}
    nav button {
      background:#ffd6e0;border:none;border-radius:8px;
      padding:0.5rem 1rem;margin:0 0.25rem;
      cursor:pointer;font-size:1rem;transition:0.3s;
    }
    nav button:hover {background:#ffb6c1;}
    #filters,#quiz,#details,#summary {padding:1rem;}
    #filters input,#filters select,#filters button {
      margin:0.25rem;padding:0.4rem;border-radius:6px;border:1px solid #ccc;font-size:0.9rem;
    }
    #list {display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;padding:1rem;}
    .card {
      background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);
      padding:1rem;cursor:pointer;transition:transform 0.2s;
    }
    .card:hover {transform:translateY(-4px);}
    .modal {
      position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.5);display:none;
      justify-content:center;align-items:center;z-index:1000;
    }
    .modal-content {
      background:#fff;border-radius:12px;padding:1rem;
      max-width:90%;max-height:90%;overflow-y:auto;position:relative;
    }
    .gallery img {width:48%;border-radius:8px;margin:2px;cursor:pointer;}
    button.action {
      background:#a7e8bd;border:none;border-radius:8px;
      padding:0.5rem 1rem;margin:0.5rem 0;font-size:1rem;cursor:pointer;transition:0.3s;
    }
    button.action:hover {background:#7cd68b;}
    #quiz img {max-width:100%;border-radius:12px;margin:1rem 0;cursor:pointer;}
    .options button {
      display:block;width:100%;margin:0.25rem 0;
      background:#ffd6e0;border:none;border-radius:8px;
      padding:0.5rem;cursor:pointer;font-size:1rem;transition:0.3s;
    }
    .options button:hover {background:#ffb6c1;}
    .progress {height:8px;background:#ddd;border-radius:4px;overflow:hidden;margin:1rem 0;}
    .progress-bar {height:100%;width:0;background:#a7e8bd;transition:width 0.3s;}
    #summary .card {margin-bottom:1rem;}
    #summary img {max-width:100%;border-radius:8px;margin-bottom:0.5rem;}
  </style>
</head>
<body>
  <header>
    <h1>ฐานข้อมูลพรรณไม้</h1>
    <nav>
      <button onclick="showMode('learning')">โหมดเรียนรู้</button>
      <button onclick="showMode('quiz')">โหมดทาย</button>
    </nav>
  </header>

  <!-- โหมดเรียนรู้ -->
  <section id="learning">
    <div id="filters">
      <input type="text" id="search" placeholder="ค้นหาพันธุ์หรือชื่อวิทยาศาสตร์">
      <select id="filter-วิสัย"><option value="">วิสัย</option></select>
      <select id="filter-ชนิดใบ"><option value="">ชนิดใบ</option></select>
      <select id="filter-การเรียงตัวของใบ"><option value="">การเรียงตัวของใบ</option></select>
      <select id="filter-พันธุ์ไม้"><option value="">พันธุ์ไม้</option></select>
      <select id="filter-สถานะ"><option value="">สถานะ</option></select>
      <button onclick="clearFilters()">ล้างตัวกรอง</button>
      <span id="count"></span>
    </div>
    <div id="list"></div>
  </section>

  <!-- โหมด Quiz -->
  <section id="quiz" style="display:none;">
    <div id="quiz-container">
      <button class="action" onclick="startQuiz()">เริ่มเกม</button>
      <div class="progress"><div class="progress-bar" id="quiz-progress"></div></div>
      <div id="quiz-question"></div>
      <div class="options" id="quiz-options"></div>
      <div id="quiz-feedback"></div>
      <div id="quiz-score"></div>
    </div>
  </section>

  <!-- สรุปผล -->
  <section id="summary" style="display:none;">
    <h2>สรุปผลการทดสอบ</h2>
    <div id="summary-list"></div>
    <button class="action" onclick="showMode('quiz')">เล่นใหม่</button>
  </section>

  <!-- Modal -->
  <div id="details" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div id="detail-content"></div>
      <button class="action" onclick="document.getElementById('details').style.display='none'">ปิด</button>
    </div>
  </div>

  <!-- Modal ดูรูปใหญ่ -->
  <div id="imageModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" style="text-align:center;" onclick="event.stopPropagation()">
      <img id="modalImage" src="" style="max-width:100%;max-height:80vh;border-radius:12px;">
    </div>
  </div>

  <script>
    // ---------------- ข้อมูลตัวอย่าง ----------------
    const DATA = [
      {"พันธุ์":"ถอบแถบทะเล","ชื่อวิทยาศาสตร์":"Derris trifoliata Lour.","พันธุ์ไม้":"แท้","วิสัย":"ไม้เลื้อย","ใบ":"ใบประกอบ","ชนิดใบ":"ใบประกอบขนนกปลายคี่","การเรียงตัวของใบ":"เรียงเวียนสลับ","ราก":"","สถานะ":"ยังไม่ได้รับการประเมิน","ภาพลำต้น":"","ภาพใบ":"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Derris_trifoliata_%28leaves%29.jpg/320px-Derris_trifoliata_%28leaves%29.jpg","ภาพดอก":"","ภาพผล":""},
      {"พันธุ์":"ชมพูพันธุ์ทิพย์","ชื่อวิทยาศาสตร์":"Tabebuia rosea","พันธุ์ไม้":"ต่างถิ่น","วิสัย":"ไม้ยืนต้น","ใบ":"ใบประกอบ","ชนิดใบ":"ใบประกอบนิ้วมือ","การเรียงตัวของใบ":"ตรงข้าม","ราก":"","สถานะ":"ยังไม่ได้รับการประเมิน","ภาพลำต้น":"","ภาพใบ":"","ภาพดอก":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Tabebuia_roseacherryblossoms_bangkok.jpg/320px-Tabebuia_roseacherryblossoms_bangkok.jpg","ภาพผล":""}
    ];

    let filtered=[...DATA];
    let quizIndex=0,score=0,quizData=[],quizAnswers=[];

    function showMode(mode){
      document.getElementById('learning').style.display=(mode==='learning')?'block':'none';
      document.getElementById('quiz').style.display=(mode==='quiz')?'block':'none';
      document.getElementById('summary').style.display=(mode==='summary')?'block':'none';
    }

    function loadData(){
      renderList();populateFilters();
    }

    function renderList(){
      const list=document.getElementById('list');
      list.innerHTML='';
      filtered.forEach(item=>{
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`<h3>${item.พันธุ์}</h3><p><em>${item.ชื่อวิทยาศาสตร์}</em></p>`;
        card.onclick=()=>renderDetail(item);
        list.appendChild(card);
      });
      document.getElementById('count').innerText=`พบ ${filtered.length} รายการ`;
    }

    function renderDetail(item){
      const detail=document.getElementById('detail-content');
      detail.innerHTML=`
        <h2>${item.พันธุ์}</h2>
        <p><em>${item.ชื่อวิทยาศาสตร์}</em></p>
        <p><b>พันธุ์ไม้:</b> ${item.พันธุ์ไม้||'-'}</p>
        <p><b>วิสัย:</b> ${item.วิสัย||'-'}</p>
        <p><b>ใบ:</b> ${item.ใบ||'-'}</p>
        <p><b>ชนิดใบ:</b> ${item.ชนิดใบ||'-'}</p>
        <p><b>การเรียงตัวของใบ:</b> ${item.การเรียงตัวของใบ||'-'}</p>
        <p><b>ราก:</b> ${item.ราก||'-'}</p>
        <p><b>สถานะ:</b> ${item.สถานะ||'-'}</p>
        <div class="gallery">
          ${renderImage(item.ภาพลำต้น,'ลำต้น')}
          ${renderImage(item.ภาพใบ,'ใบ')}
          ${renderImage(item.ภาพดอก,'ดอก')}
          ${renderImage(item.ภาพผล,'ผล')}
        </div>`;
      document.getElementById('details').style.display='flex';
    }

    function renderImage(url,label){
      return url? `<img src="${url}" alt="${label}" onclick="openImage('${url}')">` : `<div style="width:48%;height:100px;display:inline-flex;align-items:center;justify-content:center;background:#eee;border-radius:8px;">ไม่มีภาพ</div>`;
    }

    function openImage(url){
      document.getElementById('modalImage').src=url;
      document.getElementById('imageModal').style.display='flex';
    }

    function populateFilters(){
      ['วิสัย','ชนิดใบ','การเรียงตัวของใบ','พันธุ์ไม้','สถานะ'].forEach(f=>{
        const sel=document.getElementById('filter-'+f);
        const vals=[...new Set(DATA.map(d=>d[f]).filter(v=>v))];
        vals.forEach(v=>{
          const opt=document.createElement('option');opt.value=v;opt.textContent=v;sel.appendChild(opt);
        });
        sel.onchange=applyFilters;
      });
      document.getElementById('search').oninput=applyFilters;
    }

    function applyFilters(){
      const search=document.getElementById('search').value.toLowerCase();
      filtered=DATA.filter(item=>{
        if(search && !(item.พันธุ์.toLowerCase().includes(search)||item.ชื่อวิทยาศาสตร์.toLowerCase().includes(search))) return false;
        for(const f of ['วิสัย','ชนิดใบ','การเรียงตัวของใบ','พันธุ์ไม้','สถานะ']){
          const val=document.getElementById('filter-'+f).value;
          if(val && item[f]!==val) return false;
        }
        return true;
      });
      renderList();
    }

    function clearFilters(){
      document.getElementById('search').value='';
      ['วิสัย','ชนิดใบ','การเรียงตัวของใบ','พันธุ์ไม้','สถานะ'].forEach(f=>{
        document.getElementById('filter-'+f).value='';
      });
      filtered=[...DATA];renderList();
    }

    // ---------------- Quiz ----------------
    function startQuiz(){
      quizData=shuffle(DATA.filter(d=>d.ภาพลำต้น||d.ภาพใบ||d.ภาพดอก||d.ภาพผล)).slice(0,15);
      if(quizData.length===0){document.getElementById('quiz-question').innerHTML='ไม่มีข้อมูลภาพสำหรับการทดสอบ';return;}
      quizIndex=0;score=0;quizAnswers=[];
      nextQuestion();
    }

    function nextQuestion(){
      if(quizIndex>=quizData.length){showSummary();return;}
      const item=quizData[quizIndex];
      const images=[item.ภาพใบ,item.ภาพดอก,item.ภาพผล,item.ภาพลำต้น].filter(x=>x);
      const img=images[Math.floor(Math.random()*images.length)];
      document.getElementById('quiz-question').innerHTML=`<h3>ข้อ ${quizIndex+1}/${quizData.length}: ภาพนี้คือพันธุ์อะไร?</h3><img src="${img}" onclick="openImage('${img}')">`;
      const options=shuffle([item,...pickRandomOptions(item,3)]);
      const optDiv=document.getElementById('quiz-options');optDiv.innerHTML='';
      options.forEach(opt=>{
        const btn=document.createElement('button');
        btn.textContent=opt.พันธุ์;
        btn.onclick=()=>gradeAnswer(opt,item,img);
        optDiv.appendChild(btn);
      });
      document.getElementById('quiz-feedback').innerHTML='';
      document.getElementById('quiz-score').innerHTML=`คะแนน: ${score}`;
      document.getElementById('quiz-progress').style.width=`${(quizIndex/quizData.length)*100}%`;
    }

    function gradeAnswer(selected,correct,img){
      let correctFlag=false;
      if(selected===correct){score++;correctFlag=true;
        document.getElementById('quiz-feedback').innerHTML='<p style="color:green;">ถูกต้อง!</p>';
      } else {
        document.getElementById('quiz-feedback').innerHTML=`<p style="color:red;">ผิด! คำตอบที่ถูกคือ ${correct.พันธุ์}</p>`;
      }
      quizAnswers.push({img:img,selected:selected.พันธุ์,correct:correct.พันธุ์,isCorrect:correctFlag});
      quizIndex++;
      setTimeout(nextQuestion,2500);
    }

    function pickRandomOptions(correct,n){
      const others=DATA.filter(d=>d!==correct);
      return shuffle(others).slice(0,n);
    }

    function shuffle(arr){return arr.sort(()=>Math.random()-0.5);}

    function showSummary(){
      showMode('summary');
      document.getElementById('quiz-progress').style.width='100%';
      const list=document.getElementById('summary-list');list.innerHTML='';
      quizAnswers.forEach((ans,i)=>{
        const card=document.createElement('div');card.className='card';
        card.innerHTML=`
          <h3>ข้อ ${i+1}</h3>
          <img src="${ans.img}" onclick="openImage('${ans.img}')">
          <p><b>คำตอบที่เลือก:</b> ${ans.selected}</p>
          <p><b>คำตอบที่ถูก:</b> ${ans.correct}</p>
          <p style="color:${ans.isCorrect?'green':'red'};">${ans.isCorrect?'ถูกต้อง':'ผิด'}</p>`;
        list.appendChild(card);
      });
      const summaryHeader=document.createElement('div');
      summaryHeader.innerHTML=`<h3>คะแนนรวม: ${score}/${quizData.length}</h3>`;
      list.prepend(summaryHeader);
    }

    loadData();
  </script>
</body>
</html>
